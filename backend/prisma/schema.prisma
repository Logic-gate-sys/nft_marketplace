generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          Int          @id @default(autoincrement())
  wallet      String       @unique
  username   String?
  email       String?
  created_at  DateTime     @default(now())

  // relations
  collections Collection[]
  nfts        Nft[]
  bought      Sold[]       @relation("Buyer_User")
  sold        Sold[]       @relation("Seller_User")
}

model Collection {
  id        Int      @id @default(autoincrement())
  user_id   Int
  col_uri   String
  address   String?
  createdAt DateTime @default(now())
  changed   Boolean? @default(true) 

  // relations
  User      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  Nft      Nft[]
}

model Nft {
  id            Int        @id @default(autoincrement())
  token_id      Int
  col_id        Int
  uri           String    @unique
  owner_id      Int
  base_price    String?
  current_price String?
  status        String     @default("unlisted")
  createdAt     DateTime   @default(now())
  changed       Boolean?       @default(true)// this tracks whether something has changed recently or not 

  //relations
  collection    Collection @relation(fields: [col_id], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [owner_id], references: [id], onDelete: Cascade)
}

model Sold {
  id        Int      @id @default(autoincrement())
  token_id  Int
  buyer     String
  seller    String
  price     String
  changed   Boolean? @default(true)
  soldAt    DateTime @default(now())


  //relations
  u_buyer     User     @relation("Buyer_User", fields: [buyer], references: [wallet], onDelete: Cascade)
  u_seller    User     @relation("Seller_User", fields: [seller], references: [wallet], onDelete: Cascade)
}
